<table class='table table-hover table-inverse posts-index-table'>
  <thead>
    <tr>
      <th></th>
      <th>タイトル</th>
      <th><%= sort_link_for_posts('公開年', 'release') %></th>
      <th><%= sort_link_for_posts('時系列', 'timeline') %></th>
      <th>タグ</th>
      <th>コメント数</th>
      <th>いいね</th>
      <th>投稿者</th>
      <th>評価</th>
      <th>感情分析</th>
    </tr>
  </thead>
  <tbody>
    <% posts.each do |post| %>
      <tr>
        <td><%= image_tag post.get_image(70, 70) %>
        </td>
        <td><%= link_to post.title,post, class: "post_#{post.id}" %></td>
        <td><%= post.release %></td>
        <td><%= post.timeline %></td>
        <td>
          <% if post.tag.present? %>
            <%= link_to post.tag, search_path(model: 'post_tag', method: 'partial', content: post.tag) %>
          <% end %>
        </td>
        <td><%= post.comments.count %></td>
        <td>
          <div id="post_<%= post.id %>">
            <%= render "public/favorites/btn", post: post %>
          </div>
        </td>
        <td><%= link_to post.user.name,post.user, class: "user_#{post.user.id}" %></td>
        <td>
          <div id="raty_<%= post.id %>"></div>
        </td>
        <td><%= post.score %></td>
      </tr>
    <% end %>
  </tbody>

  <span id="back">
    <a href="#">
      <%= image_tag "arrow.png", alt: "トップへ戻る" %>
    </a>
  </span>

</table>

<script>
  $(document).on('turbolinks:load', function() {
    <% posts.each do |post| %>
      (function() {
        var elem = document.querySelector('#raty_<%= post.id %>');
        if (!elem) return;

        elem.innerHTML = "";
        var opt = {
          starOn: "<%= asset_path('star-on.png') %>",
          starOff: "<%= asset_path('star-off.png') %>",
          starHalf: "<%= asset_path('star-half.png') %>",
          score: <%= post.rate.present? ? post.rate : 'undefined' %>,
          readOnly: true
        };
        raty(elem, opt);
      })();
    <% end %>

    $('#back a').on('click', function(event) {
      $('body, html').animate({ scrollTop: 0 }, 800);
      event.preventDefault();
    });
  });
</script>